<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Wiskoro Chatbot - Je persoonlijke wiskunde G die je door alle sommen heen carried! ðŸ”¥">
    <title>Wiskoro Chatbot</title>
    <link rel="preconnect" href="https://rsms.me">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <style>
        :root {
            color-scheme: light dark;
            /* Basis kleuren definities */
            --bg-color-light: #f9f9f9;
            --bg-color-dark: #1e1e1e;
            --text-color-light: #333;
            --text-color-dark: #f5f5f5;
            --chat-bg-light: #ffffff;
            --chat-bg-dark: #2a2a2a;
            --border-color-light: #ddd;
            --border-color-dark: #444;
            --button-color-light: #007aff;
            --button-color-dark: #0a84ff;
            --button-hover-light: #005ecb;
            --button-hover-dark: #0070e6;
            --message-bg-bot-light: #f1f1f1;
            --message-bg-bot-dark: #3a3a3a;
            --focus-outline: #4a9eff;
            
            /* Default light mode waarden */
            --bg-color: var(--bg-color-light);
            --text-color: var(--text-color-light);
            --chat-bg: var(--chat-bg-light);
            --border-color: var(--border-color-light);
            --button-color: var(--button-color-light);
            --button-hover: var(--button-hover-light);
            --message-bg-bot: var(--message-bg-bot-light);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                /* Dark mode waarden */
                --bg-color: var(--bg-color-dark);
                --text-color: var(--text-color-dark);
                --chat-bg: var(--chat-bg-dark);
                --border-color: var(--border-color-dark);
                --button-color: var(--button-color-dark);
                --button-hover: var(--button-hover-dark);
                --message-bg-bot: var(--message-bg-bot-dark);
            }
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            line-height: 1.5;
            text-align: center;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
        }

        #chat-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 100%;
            height: 100vh;
            margin: 0;
            padding: 0;
            background-color: var(--chat-bg);
            overflow: hidden;
        }

        #chat-box {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            margin-bottom: 80px;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        .message {
            margin: 0.5rem 0;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            max-width: 80%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(0.5rem); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .user {
            background-color: var(--button-color);
            color: white;
            margin-left: auto;
        }

        .bot {
            background-color: var(--message-bg-bot);
            color: var(--text-color);
            margin-right: auto;
        }

        .input-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            padding-bottom: calc(1rem + env(safe-area-inset-bottom));
            background-color: var(--chat-bg);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            width: 100%;
            box-sizing: border-box;
            padding-left: max(1rem, env(safe-area-inset-left));
            padding-right: max(1rem, env(safe-area-inset-right));
        }

        #user-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            border: 2px solid var(--border-color);
            font-size: 1rem;
            transition: border-color 0.2s;
            background-color: var(--chat-bg);
            color: var(--text-color);
        }

        #user-input:focus {
            outline: none;
            border-color: var(--focus-outline);
            box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.2);
        }

        button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            border-radius: 1rem;
            border: none;
            background-color: var(--button-color);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        button:hover {
            background-color: var(--button-hover);
        }

        button:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--focus-outline);
        }

        button:active {
            transform: scale(0.98);
        }

        @media (max-width: 480px) {
            .message {
                max-width: 90%;
            }

            .input-container {
                padding: 0.75rem;
                padding-bottom: calc(0.75rem + env(safe-area-inset-bottom));
                padding-left: max(0.75rem, env(safe-area-inset-left));
                padding-right: max(0.75rem, env(safe-area-inset-right));
            }

            button {
                padding: 0.75rem;
                min-width: 70px;
            }

            #user-input {
                padding: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div id="chat-container">
        <div id="chat-box" role="log" aria-live="polite"></div>
        <form class="input-container" onsubmit="handleSubmit(event)">
            <input 
                type="text" 
                id="user-input" 
                placeholder="Drop je vraag hier, bro..." 
                aria-label="Je vraag"
                autocomplete="off"
            >
            <button type="submit" id="send-button">Gooi eruit</button>
        </form>
    </div>

    <script>
        const backendUrl = "https://wiskoro-backend.up.railway.app/chat";
        const buttonTexts = ["Gooi eruit", "Drop die vraag", "Spit die wiskunde", "Knallen maar", "Tik die som"];
        const welcomeMessages = [
            "Faka, welkom bij Wiskoro! ðŸ”¥ Tijd om je wiskunde skills te boosten!", 
            "Yo! Klaar om wiskunde te ownen? Ik fix die uitleg voor je! ðŸ“š", 
            "Ey, jij daar! Pak je sommen, want we gaan gas geven op wiskunde! ðŸš€", 
            "Bro, geen stress! Met Wiskoro maak jij wiskunde je playground!", 
            "Let's go! Hier leer je wiskunde met de meeste sauce! ðŸ§ ðŸ’¯",
            "Skeer op wiskunde? Niet meer! Tijd om te shinen met Wiskoro! âœ¨",
            "HÃ© legend! Vandaag is de dag dat je wiskunde mastert! ðŸ‘‘",
            "Wiskunde is geen drill, maar jij gaat het killen! ðŸ’ªðŸ”¥",
            "Yo, yo, yo! Pak je brein en let's gooo! ðŸ§ âš¡",
            "Geen paniek, wiskunde wordt easy met Wiskoro! ðŸ˜Ž"
        ];

        const errorMessages = [
            "Ey g, die server left us on read! ðŸ’€ Probeer ff opnieuw!",
            "Nah fam, connection is skeer rn. Check je wifi en probeer nog een x! ðŸ”Œ",
            "Yo my g, er ging iets fout in de matrix! Refresh die pagina en we gaan door! ðŸ”„",
            "Broski, de server heeft even een breakdown! Retry die ting! ðŸ˜¤",
            "Dead internet vibes... Fix je connect en we gaan verder! ðŸ“¶"
        ];

        const loadingMessages = [
            "Even die brain cells activeren...",
            "Matrix hacken voor je antwoord...",
            "Formules spotten zoals een echte G...",
            "Wiskunde sauce loading...",
            "Calculations on fleek incoming..."
        ];
        
        const sendButton = document.getElementById("send-button");
        const chatBox = document.getElementById("chat-box");
        const userInput = document.getElementById("user-input");
        let isProcessing = false;

        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function updateButtonText() {
            sendButton.textContent = getRandomItem(buttonTexts);
        }
        
        function addMessage(content, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = content;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
            return messageDiv;
        }
        
        function showWelcomeMessage() {
            addMessage(getRandomItem(welcomeMessages), 'bot');
        }

        async function handleSubmit(event) {
            event.preventDefault();
            
            const message = userInput.value.trim();
            if (!message || isProcessing) return;

            isProcessing = true;
            sendButton.disabled = true;
            
            try {
                addMessage(message, 'user');
                userInput.value = '';
                updateButtonText();

                // Toon loading message
                const loadingMessage = getRandomItem(loadingMessages);
                const loadingDiv = addMessage(loadingMessage, 'bot');

                const response = await fetch(backendUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message })
                });

                // Verwijder loading message
                loadingDiv.remove();

                if (!response.ok) {
                    throw new Error('Network response not ok');
                }

                const data = await response.json();
                addMessage(data.response || getRandomItem(errorMessages), 'bot');
            } catch (error) {
                console.error('Error:', error);
                addMessage(getRandomItem(errorMessages), 'bot');
            } finally {
                isProcessing = false;
                sendButton.disabled = false;
                userInput.focus();
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            showWelcomeMessage();
            userInput.focus();
        });

        // Voorkom dubbele submits bij enter Ã©n button click
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendButton.click();
            }
        });
    </script>
</body>
</html>
